<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impacts & Applications | BloomWatch</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js CDN for the Timeline Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Load Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        /* --- New Styles for Visualizations --- */
        .roadmap-segment {
            height: 100%;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.75rem; /* text-xs */
            transition: all 0.3s ease-in-out;
            cursor: default;
            white-space: nowrap;
        }
        .story-container {
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .story-card {
            scroll-snap-align: start;
            flex: 0 0 100%;
        }

        /* Mobile-first adjustments for desktop view */
        @media (min-width: 640px) {
            .story-container {
                scroll-snap-type: none;
                overflow-x: auto;
            }
            .story-card {
                flex: 0 0 32%; /* Show three cards side-by-side on desktop */
            }
        }
        /* Custom navigation button styles for consistency */
        .nav-link {
            transition: all 0.15s ease-in-out;
        }
    </style>
    <!-- Standard Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body class="min-h-screen">

    <!-- Navigation Bar (Duplicated for consistency) -->
    <nav class="bg-white shadow-md sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <span class="text-3xl font-extrabold text-green-600 tracking-tight">
                            <i class="fas fa-seedling mr-2"></i>BloomWatch
                        </span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Links back to index.html -->
                    <a href="index.html#home-view" class="nav-link text-gray-600 hover:text-green-600 px-3 py-2 rounded-md text-lg font-medium">Home</a>
                    <a href="index.html#map-view" class="nav-link text-gray-600 hover:text-green-600 px-3 py-2 rounded-md text-lg font-medium">Map</a>
                    <!-- Active link for this page -->
                    <a href="#" class="nav-link text-green-600 font-bold px-3 py-2 rounded-md text-lg hover:text-green-700">Impact & Applications</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container for Applications -->
    <main class="max-w-7xl mx-auto p-4 sm:p-8 text-gray-800">

        <h1 class="text-3xl sm:text-4xl font-extrabold text-green-800 mb-10 border-b-4 border-green-200 pb-3">
            üåç Global Warming & Local Application
        </h1>

        <!-- Section: Global Warming Impact (Visual Storytelling) -->
        <section class="mb-12">
            <h2 class="text-2xl sm:text-3xl font-bold text-red-600 mb-6 flex items-center">
                <i class="fa-solid fa-fire mr-3"></i> Global Warming Impact: Bloom Shift Story
            </h2>

            <!-- 3. Story Mode (Swipe/Scroll) -->
            <h3 class="text-xl font-semibold text-gray-700 mb-3">Story Mode: Kerala Mango Bloom Shift</h3>
            <div class="story-container flex overflow-x-scroll gap-4 pb-4">
                <!-- Slide 1: Baseline -->
                <div class="story-card bg-white p-6 rounded-2xl shadow-xl border-t-4 border-blue-400">
                    <p class="text-6xl mb-4">üóìÔ∏è</p>
                    <p class="text-3xl font-bold text-gray-800">2005</p>
                    <p class="text-xl font-medium text-green-600">Blooms in **March** üå∏</p>
                    <p class="text-sm text-gray-500 mt-2">Baseline data point. Average sunlight intensity recorded.</p>
                </div>
                <!-- Slide 2: Mid-point -->
                <div class="story-card bg-white p-6 rounded-2xl shadow-xl border-t-4 border-yellow-400">
                    <p class="text-6xl mb-4">‚ö†Ô∏è</p>
                    <p class="text-3xl font-bold text-gray-800">2015</p>
                    <p class="text-xl font-medium text-green-600">Blooms **10 Days Earlier** üå∏</p>
                    <p class="text-sm text-gray-500 mt-2">Sunlight Intensity slightly increased, forcing early phenology.</p>
                </div>
                <!-- Slide 3: Current -->
                <div class="story-card bg-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-6xl mb-4">üî•</p>
                    <p class="text-3xl font-bold text-gray-800">2025</p>
                    <p class="text-xl font-medium text-green-600">Blooms in **February** üå∏üå∏</p>
                    <p class="text-sm text-gray-500 mt-2">Significant shift (15+ days) linked to high ambient light and heat stress.</p>
                </div>
            </div>

            <!-- 1. Timeline Graph -->
            <h3 class="text-xl font-semibold text-gray-700 mt-8 mb-4">Timeline Graph: Bloom Date vs. Sunlight Intensity</h3>
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border">
                <canvas id="timelineChart"></canvas>
                <p class="text-xs text-gray-500 mt-4 text-center">
                    *Callout: Blooming dates are shifting **earlier** (lower on the Y-axis) as sunlight intensity (orange line) has risen since 2005.*
                </p>
            </div>

        </section>

        <div class="my-10 border-t border-gray-200"></div>

        <!-- Section: Farmers‚Äô Bloom Roadmap (Application) -->
        <section class="mb-12">
            <h2 class="text-2xl sm:text-3xl font-bold text-green-600 mb-6 flex items-center">
                <i class="fa-solid fa-wheat-awn mr-3"></i> Farmer Application: Interactive Crop Calendar
            </h2>

            <!-- Controls -->
            <div class="flex flex-col sm:flex-row gap-4 mb-8">
                <!-- Crop Dropdown -->
                <select id="crop-select" class="p-3 border border-gray-300 rounded-xl w-full sm:w-1/2 text-lg bg-white focus:ring-green-500 focus:border-green-500 shadow-sm" aria-label="Select Crop">
                    <option value="Default" selected disabled>Choose Crop...</option>
                    <option value="Mango">Mango ü•≠</option>
                    <option value="Cotton">Cotton üåø</option>
                    <option value="Rice">Rice üçö</option>
                </select>
                <!-- Location Dropdown -->
                <select id="location-select" class="p-3 border border-gray-300 rounded-xl w-full sm:w-1/2 text-lg bg-white focus:ring-green-500 focus:border-green-500 shadow-sm" aria-label="Select Location">
                    <option value="Default" selected disabled>Choose Location...</option>
                    <option value="Kerala">Kerala (South)</option>
                    <option value="Punjab">Punjab (North)</option>
                </select>
            </div>

            <!-- Roadmap Display Card -->
            <div class="bg-white shadow-2xl rounded-xl p-6 border border-green-100">
                <div id="roadmap-content">
                    <p class="text-center text-gray-500 italic py-12">Select a crop and location above to see your customized seasonal roadmap.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- JavaScript Logic for Applications -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the default roadmap and chart when the page loads
            createTimelineChart();
            setupRoadmapListeners();
            // Show a default entry to make the page immediately useful
            renderRoadmap('Mango_Kerala'); 
        });

        const roadmapContent = document.getElementById('roadmap-content');
        const cropSelect = document.getElementById('crop-select');
        const locationSelect = document.getElementById('location-select');

        // Data for the Interactive Crop Calendar
        const dummyData = {
            'Mango_Kerala': {
                name: 'Mango ü•≠',
                region: 'Kerala',
                timeline: [
                    { label: 'Bloom üå∏', startMonth: 3, endMonth: 4, color: 'bg-green-500', textColor: 'text-white' },
                    { label: 'Harvest üçã', startMonth: 5, endMonth: 7, color: 'bg-yellow-400', textColor: 'text-gray-800' },
                ],
                shift: '8 days **earlier** in bloom since 2005 (linked to rising sunlight intensity) ‚¨ÜÔ∏è'
            },
            'Cotton_Punjab': {
                name: 'Cotton üåø',
                region: 'Punjab',
                timeline: [
                    { label: 'Sowing', startMonth: 4, endMonth: 5, color: 'bg-blue-400', textColor: 'text-white' },
                    { label: 'Bloom üå∏', startMonth: 8, endMonth: 10, color: 'bg-green-500', textColor: 'text-white' },
                    { label: 'Harvest', startMonth: 11, endMonth: 1, color: 'bg-yellow-400', textColor: 'text-gray-800' },
                ],
                shift: '4 days **later** in harvest due to increased monsoon variability ‚¨áÔ∏è'
            },
            'Rice_Kerala': {
                name: 'Rice üçö',
                region: 'Kerala',
                timeline: [
                    { label: 'Sowing', startMonth: 5, endMonth: 6, color: 'bg-blue-400', textColor: 'text-white' },
                    { label: 'Bloom üå∏', startMonth: 9, endMonth: 9, color: 'bg-green-500', textColor: 'text-white' },
                    { label: 'Harvest', startMonth: 12, endMonth: 1, color: 'bg-yellow-400', textColor: 'text-gray-800' },
                ],
                shift: 'No significant shift observed recently. Requires continued monitoring.'
            },
        };

        function setupRoadmapListeners() {
            // Attach listeners when the page is ready
            cropSelect.addEventListener('change', handleSelectionChange);
            locationSelect.addEventListener('change', handleSelectionChange);
        }

        function renderRoadmap(key) {
            const data = dummyData[key];
            if (!data) {
                roadmapContent.innerHTML = '<p class="text-center text-gray-500 italic py-12">Data not available for this combination. Try Mango in Kerala or Cotton in Punjab.</p>';
                return;
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthLabels = months.map(m => `<span class="col-span-1 text-xs sm:text-sm font-medium">${m}</span>`).join('');

            const segments = data.timeline.map(item => {
                const startMonthIndex = item.startMonth - 1;
                const endMonthIndex = item.endMonth - 1;

                let durationMonths = (endMonthIndex >= startMonthIndex)
                    ? (endMonthIndex - startMonthIndex + 1)
                    : (endMonthIndex + 12 - startMonthIndex + 1);
                
                let startPosIndex = startMonthIndex;

                const widthPercent = (durationMonths / 12) * 100;
                const leftPercent = (startPosIndex / 12) * 100;

                return `
                    <div class="roadmap-segment ${item.color} ${item.textColor} p-1 rounded-full text-center" style="left: ${leftPercent}%; width: ${widthPercent}%;">
                        ${item.label}
                    </div>
                `;
            }).join('');

            // Full HTML structure for the selected roadmap
            const isShifted = data.shift.includes('earlier') || data.shift.includes('later');
            const shiftBg = isShifted ? 'bg-red-100 border-red-500' : 'bg-green-100 border-green-500';
            const shiftText = isShifted ? 'text-red-800' : 'text-green-800';
            const shiftIcon = isShifted ? '<i class="fa-solid fa-triangle-exclamation"></i>' : '<i class="fa-solid fa-circle-check"></i>';


            roadmapContent.innerHTML = `
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6">${data.name} Roadmap in ${data.region}</h3>

                <!-- Roadmap Bar Container (Gantt-style) -->
                <div class="relative h-12 rounded-full bg-gray-200 mb-8 overflow-hidden">
                    ${segments}
                </div>

                <!-- Month Labels Grid -->
                <div class="grid grid-cols-12 text-center text-sm font-medium text-gray-500 mb-6 border-b pb-2">
                    ${monthLabels}
                </div>

                <!-- Shift Trend Card -->
                <div class="p-4 ${shiftBg} border-l-4 rounded-lg shadow-inner mt-6">
                    <p class="font-semibold ${shiftText} mb-1 flex items-center">
                        <span class="mr-2">${shiftIcon}</span>
                        Shift Trend (Climate Resilience)
                    </p>
                    <p class="text-base text-gray-900 leading-snug">
                        ${data.name} is observing a shift of: <span class="font-bold">${data.shift}</span>
                    </p>
                </div>
            `;
        }

        function handleSelectionChange() {
            const crop = cropSelect.value;
            const location = locationSelect.value;

            if (crop !== 'Default' && location !== 'Default') {
                renderRoadmap(`${crop}_${location}`);
            } else {
                // If the user selects a default, revert to the initial view/instructions
                roadmapContent.innerHTML = '<p class="text-center text-gray-500 italic py-12">Select a crop and location above to see your customized seasonal roadmap.</p>';
            }
        }

        // --- Global Warming Timeline Chart (Chart.js) ---
        function createTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            const years = ['2000', '2005', '2010', '2015', '2020', '2025'];
            
            const bloomData = [95, 80, 70, 65, 60, 50]; 
            const sunlightData = [40, 50, 65, 75, 85, 95]; 

            window.timelineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Blooming Date (Day of Year)',
                            data: bloomData,
                            borderColor: 'rgb(59, 130, 246)', 
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.3,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                        },
                        {
                            label: 'Sunlight Intensity Index',
                            data: sunlightData,
                            borderColor: 'rgb(245, 158, 11)', 
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            yAxisID: 'y2',
                            tension: 0.3,
                            pointStyle: 'star',
                            pointRadius: 6,
                            pointHoverRadius: 8,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(0);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Year',
                                font: { weight: 'bold' }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Blooming Date (Earlier ‚Üí Lower)',
                                font: { weight: 'bold' }
                            },
                            reverse: false, 
                            grid: {
                                color: 'rgba(59, 130, 246, 0.2)',
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Sunlight Intensity (Index)',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                drawOnChartArea: false, 
                                color: 'rgba(245, 158, 11, 0.2)',
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
